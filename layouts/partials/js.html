{{ "<!-- jQuery -->" | safeHTML }}
<script src="{{ "js/jquery.js" | absURL }}"></script>
{{ "<!-- Bootstrap Core JavaScript -->" | safeHTML }}
<script src="{{ "js/bootstrap.min.js" | absURL }}"></script>
{{ "<!-- Plugin JavaScript -->" | safeHTML }}
<script src="{{ "js/jquery.easing.min.js" | absURL }}"></script>
<script src="{{ "js/jquery.fittext.js" | absURL }}"></script>
<script src="{{ "js/wow.min.js" | absURL }}"></script>
{{ if .Site.Params.location }}
<script src="//maps.googleapis.com/maps/api/js?key={{ .Site.Params.location.maps_api_key }}&v=3.exp"></script>
<script src="{{ "js/hpneo.gmaps.js" | absURL }}"></script>
<script src="{{ "js/gmaps.init.js" | absURL }}"></script>
{{ end }}
{{ "<!-- Custom Theme JavaScript -->" | safeHTML }}
<script src="{{ "js/creative.js" | absURL }}"></script>
<script src="{{ "js/slick.min.js" | absURL }}"></script>
<script src="{{ "js/owl.carousel.min.js" | absURL }}"></script>

<script type="text/javascript">
    var projects = {{.Site.Data.projects}};
    
  // Handle interactive svg map
  var lang = {{.Site.Language.Lang}};
  var countries = {{.Site.Data.map}};

  // Initialize all interaction and display of projects within a country on the map
  Object.keys(countries).map((mapId) => {
    $('#' + mapId).attr("class", "visited");
    
    $('#iconem-map-svg path#' + mapId).hover((e) => {
      $('#iconem-map-infos-country').append(countries[mapId].name[lang]);

      var cityCellsToAppend = '';
      var siteCellsToAppend = '';

      countries[mapId].places.map((place) => {
        cityCellsToAppend += 
        '<div class="iconem-map-infos-city-cell">' +
          '<div class="iconem-map-infos-city">' + place.name[lang] + '</div>';

        siteCellsToAppend += '<div class="iconem-map-infos-site-cell">';

        place.sites.map((site, index)=> {
          if (index === 0) {
            var name;
            if (site.name[lang].length > place.name[lang].length) {
              name = site.name[lang];
            } else {
              name = place.name[lang];
            }
            cityCellsToAppend += '<div class="iconem-map-infos-site">' + name + '</div>';
          } else {
            cityCellsToAppend += '<div class="iconem-map-infos-site">' + site.name[lang] + '</div>';
          }
          siteCellsToAppend += '<div class="iconem-map-infos-site">' + site.name[lang] + '</div>';
        });

        cityCellsToAppend += '</div>';
        siteCellsToAppend += '</div>';
      });
      $('#iconem-map-infos-city-col').append(cityCellsToAppend);
      $('#iconem-map-infos-site-col').append(siteCellsToAppend);
      $('#iconem-map-infos').css('display','flex');

      //Add text animation (vertical scroll) if necessary
      var element = $('#iconem-map-infos-description-container > div')[0];
      if (element.offsetHeight < element.scrollHeight) {
        $('#iconem-map-infos-description').addClass('crawl');
      } 
    });
 
    $('#iconem-map-svg path#' + mapId).mouseleave((e) => {
      $('#iconem-map-infos-country').empty();
      $('#iconem-map-infos-city-col').empty();
      $('#iconem-map-infos-site-col').empty();
      $('#iconem-map-infos-description').removeClass('crawl');
      $('#iconem-map-infos').css('display','none');
    });
  });
</script>

<script type="text/javascript">
  // init tooltips
  $(document).ready(function() {
    $(function () {
      $('[data-toggle="tooltip"]').tooltip()
    })
  });
</script>

<script type="text/javascript">
  // config projects section carousel
  $(document).ready(function() {
    $('#main-projects-carousel').slick({
      rows: 3,
      slidesPerRow: 4,
      infinite: false,
      adaptiveHeight: true,
      dots: true,
      appendDots: $('#main-projects-carousel-dots-container'),
      dotsClass: 'main-projects-carousel-dots',
      arrows:false,
      setPosition:true,
      responsive: [
        {
          breakpoint: 1200,
          settings: {
            rows: 3,
            slidesPerRow: 3
          }
        },
        {
          breakpoint: 800,
          settings: {
            rows: 3,
            slidesPerRow: 2
          }
        },
        {
          breakpoint: 600,
          settings: {
            rows: 2,
            slidesPerRow: 1
          }
        }
      ]
    });

    // Resize projects slider when opening a modal so that we do not display next projects below the scrollbar when it disappear
    $(window).on('show.bs.modal', () => {
      $('#main-projects-carousel').slick('resize');
    });

  });
</script>

<script type="text/javascript">
  $(document).ready(function(){
    var projects = {{.Site.Data.projects}};

    // carousel config for preview images in project modals
    var modalPreviewCarouselConfig = {
      items: 1,
      loop: true,
      dots: true,
      // autoplay: true,
      autoplayTimeout: 4000,
      autoplayHoverPause: true,
      lazyLoad: true,
      nav: true,
      navText: ['<i class="fa fa-angle-left fa-2x"></i>','<i class="fa fa-angle-right fa-2x"></i>']
    };

    var modalVideoCarouselConfig = {
      items: 1, 
      loop: false,
      nav: true,
      video: true,
      lazyLoad: true,
      navText: ['<i class="fa fa-angle-left fa-2x"></i>','<i class="fa fa-angle-right fa-2x"></i>'],
      onInitialized: function() {
        var carousel = this.$element;
        var carouselId = carousel.parent().attr('id');
        var projectId = carouselId.split('-')[1];
        var project = projects[projectId];
        carousel.find('.owl-video-wrapper').each(function(index){
          var previewContainer = document.createElement('div');
          previewContainer.classList.add('project-video-preview');
          var img = document.createElement('img');
          img.src = project.video[index].preview;
          previewContainer.appendChild(img);
          this.appendChild(previewContainer);
        });
      }
    };

    var modal3DCarouselConfig = {
      items: 1, 
      loop: false,
      nav: true,
      lazyLoad: true,
      navText: ['<i class="fa fa-angle-left fa-2x"></i>','<i class="fa fa-angle-right fa-2x"></i>']
    };

    /* Fix owl-carousel bad behaviour */
    // $(window).on('shown.bs.modal', (e) => {
    // Previous line do not work using a fade class on the modal element. This is just a fix so that we can init carousel once the modal is displayed, after fade animation
    $(document).on($.support.transition.end, '.modal.fade.in', function(e) {
      var $target = $(e.target);

      if ($(e.target).is(".iconem-modal")) {
        // an iconem modal has just opened

        // We init the preview image carrousel element of the modal, once is is visible
        $(e.target).find(".collapse.in .owl-carousel").owlCarousel(modalPreviewCarouselConfig);
      }
    });

    // We init the carrousel element of the tab we are currently displaying, once it is visible
    $('.panel').on('shown.bs.collapse',  (e) => {
      var panelCarousel = $(e.target).find('.owl-carousel').first();
      if (panelCarousel.hasClass('preview-carousel')) {
        panelCarousel.owlCarousel(modalPreviewCarouselConfig);
      } else if (panelCarousel.hasClass('video-carousel')) {
        panelCarousel.owlCarousel(modalVideoCarouselConfig);
      } else if (panelCarousel.hasClass('3d-carousel')) {
        panelCarousel.owlCarousel(modal3DCarouselConfig);
      }
    });

    // handle carousel navigation using keyboard arrows
    $(document).keyup(function (e) {
      if (e.keyCode === 37) {
        //left arrow
        var currentlyOpenCarousel = $('.modal.fade.in .collapse.in .owl-carousel').first();
        currentlyOpenCarousel.trigger('prev.owl.carousel');
      }
      if (e.keyCode === 39) {
        //rightarrow
        var currentlyOpenCarousel = $('.modal.fade.in .collapse.in .owl-carousel').first();
        currentlyOpenCarousel.trigger('next.owl.carousel');
      }
    });

  });
</script>

<!-- carousel config for clients/partners -->
<script type="text/javascript">
  $(document).ready(function(){
    $("#partners .owl-carousel").owlCarousel({
      nav: false,
      dots: false,
      autoplay: true,
      // autoWidth: true,
      // loop: true,
      autoplayHoverPause: true,
      responsive : {
        // breakpoint from 0 up
        0 : {
          items: 2
        },
        // breakpoint from 480 up
        480 : {
          items: 4
        },
        // breakpoint from 768 up
        768 : {
          items: 8
        }
      }
    });
  });
</script>